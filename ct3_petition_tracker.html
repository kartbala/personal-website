<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CT-03 Pre-Signature Tracker</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 1rem;
    line-height: 1.4;
    font-size: 18px;
  }
  h1 { text-align: center; }
  .progress-container {
    position: relative;
    width: 100%;
    height: 40px;
    background: #e0e0e0;
    border-radius: 20px;
    overflow: hidden;
  }
  .progress-bar {
    height: 100%;
    background: #4caf50;
    width: 0;
    transition: width 0.5s;
  }
  .progress-marker {
    position: absolute;
    top: 0; bottom: 0;
    width: 3px;
    background: #ffa000;
  }
  #stats { margin-top: 1rem; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
  @media (max-width: 600px) {
    body { font-size: 16px; }
    .progress-container { height: 30px; }
  }
</style>
</head>
<body>
<h1>CT-03 Pre-Signature Tracker</h1>
<section id="progress-section">
  <div class="progress-container">
    <div id="progress-bar" class="progress-bar"></div>
    <div class="progress-marker" style="left: calc(4300 / 9000 * 100%);"></div>
  </div>
  <div id="stats"></div>
</section>
<section id="pre-section">
  <h2>Pre-signatures (before Apr 28, 2026)</h2>
  <input type="number" id="pre-input" min="0" />
</section>
<section id="town-section">
  <h2>Town-by-town Breakdown</h2>
  <table id="town-table">
    <thead>
      <tr><th>Town</th><th>Signatures</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</section>
<script>
const GOAL = 9000;
const MINIMUM = 4300;
const TOWNS = ['Ansonia','Beacon Falls','Bethany','Branford','Derby','Durham','East Haven','Guilford','Hamden','Middlefield','Milford','Naugatuck','New Haven','North Branford','North Haven','Orange','Prospect','Wallingford','West Haven','Woodbridge'];

let data = JSON.parse(localStorage.getItem('ct3_petition')) || {
  pre: 0,
  towns: Object.fromEntries(TOWNS.map(t => [t,0]))
};

const progressBar = document.getElementById('progress-bar');
const statsEl = document.getElementById('stats');
const preInput = document.getElementById('pre-input');
const townTableBody = document.querySelector('#town-table tbody');

function save() { localStorage.setItem('ct3_petition', JSON.stringify(data)); }

function totalSignatures() {
  const townTotal = Object.values(data.towns).reduce((a,b)=>a+b,0);
  return data.pre + townTotal;
}

function updateProgress() {
  const total = totalSignatures();
  const percent = Math.min(100, (total/GOAL)*100);
  progressBar.style.width = percent + '%';
  statsEl.textContent = `Total pre-signatures: ${total.toLocaleString()} / ${GOAL.toLocaleString()} (min ${MINIMUM.toLocaleString()})`;
  preInput.value = data.pre;
}

preInput.addEventListener('change', () => {
  const val = parseInt(preInput.value,10);
  data.pre = isNaN(val)?0:val;
  save();
  updateProgress();
});

function renderTowns() {
  townTableBody.innerHTML='';
  TOWNS.forEach(t => {
    const tr = document.createElement('tr');
    const nameTd = document.createElement('td');
    nameTd.textContent = t;
    const countTd = document.createElement('td');
    const input = document.createElement('input');
    input.type='number';
    input.min='0';
    input.value = data.towns[t] || 0;
    input.addEventListener('change', ()=>{
      data.towns[t] = parseInt(input.value,10) || 0;
      save();
      updateProgress();
    });
    countTd.appendChild(input);
    tr.appendChild(nameTd);
    tr.appendChild(countTd);
    townTableBody.appendChild(tr);
  });
}

renderTowns();
updateProgress();
</script>
</body>
</html>
