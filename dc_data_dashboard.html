<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DC Data Dashboard - Karthik Balasubramanian</title>
<meta name="description" content="Real-time transportation, civic, and accessibility data for Washington DC">
<link rel="stylesheet" href="styles.css">
<style>
/* DC Dashboard specific styles */
body.dc-dashboard {
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
  color: white;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  margin: 0;
  padding: 20px;
  min-height: 100vh;
}

.dashboard-container {
  max-width: 1400px;
  margin: 0 auto;
}

.dashboard-header {
  text-align: center;
  margin-bottom: 40px;
  padding: 30px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 16px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.dashboard-header h1 {
  font-size: 2.5rem;
  margin-bottom: 10px;
  background: linear-gradient(45deg, #87CEFA, #00246B);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.dashboard-header p {
  font-size: 1.1rem;
  opacity: 0.9;
  margin: 0;
}

.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.dashboard-card {
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 16px;
  padding: 24px;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.dashboard-card:hover {
  border-color: #87CEFA;
  transform: translateY(-2px);
  box-shadow: 0 8px 32px rgba(135, 206, 250, 0.2);
}

.card-header {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
}

.card-icon {
  font-size: 2rem;
  margin-right: 12px;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}

.card-title {
  font-size: 1.3rem;
  font-weight: 600;
  margin: 0;
  color: #87CEFA;
}

.card-subtitle {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.7);
  margin: 4px 0 0 0;
}

.metric-value {
  font-size: 2.5rem;
  font-weight: bold;
  color: #00ff88;
  margin: 16px 0 8px 0;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.metric-label {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 16px;
}

.status-indicator {
  display: inline-flex;
  align-items: center;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
  margin-bottom: 12px;
}

.status-good {
  background: rgba(0, 255, 136, 0.2);
  color: #00ff88;
  border: 1px solid rgba(0, 255, 136, 0.3);
}

.status-warning {
  background: rgba(255, 193, 7, 0.2);
  color: #ffc107;
  border: 1px solid rgba(255, 193, 7, 0.3);
}

.status-alert {
  background: rgba(255, 107, 107, 0.2);
  color: #ff6b6b;
  border: 1px solid rgba(255, 107, 107, 0.3);
}

.data-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.data-list li {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.data-list li:last-child {
  border-bottom: none;
}

.line-name {
  font-weight: 600;
  color: #87CEFA;
}

.delay-time {
  font-weight: bold;
}

.delay-good { color: #00ff88; }
.delay-warning { color: #ffc107; }
.delay-alert { color: #ff6b6b; }

.loading {
  text-align: center;
  color: rgba(255, 255, 255, 0.6);
  font-style: italic;
}

.error {
  color: #ff6b6b;
  background: rgba(255, 107, 107, 0.1);
  padding: 12px;
  border-radius: 8px;
  border: 1px solid rgba(255, 107, 107, 0.3);
}

.last-updated {
  text-align: center;
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.6);
  margin-top: 20px;
  padding: 16px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 8px;
}

.refresh-btn {
  background: #00246B;
  color: white;
  border: 2px solid #00246B;
  border-radius: 999px;
  padding: 12px 24px;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  transition: all 0.3s ease;
  margin: 8px;
}

.refresh-btn:hover {
  background: #C41E3A;
  border-color: #C41E3A;
  transform: scale(1.05);
}

.chart-container {
  height: 200px;
  margin: 16px 0;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  padding: 16px;
  position: relative;
}

.accessibility-score {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 12px 0;
}

.score-circle {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 1.2rem;
  border: 3px solid;
}

.score-excellent {
  background: rgba(0, 255, 136, 0.2);
  border-color: #00ff88;
  color: #00ff88;
}

.score-good {
  background: rgba(255, 193, 7, 0.2);
  border-color: #ffc107;
  color: #ffc107;
}

.score-poor {
  background: rgba(255, 107, 107, 0.2);
  border-color: #ff6b6b;
  color: #ff6b6b;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
  .dashboard-grid {
    grid-template-columns: 1fr;
    gap: 16px;
  }
  
  .dashboard-header {
    padding: 20px;
    margin-bottom: 30px;
  }
  
  .dashboard-header h1 {
    font-size: 2rem;
  }
  
  .dashboard-card {
    padding: 20px;
  }
  
  .metric-value {
    font-size: 2rem;
  }
}

/* Animation for loading data */
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.loading {
  animation: pulse 1.5s ease-in-out infinite;
}
</style>
</head>
<body class="dc-dashboard">

<div class="dashboard-container">
  <header class="dashboard-header">
    <h1>üèõÔ∏è DC Data Dashboard</h1>
    <p>Real-time transportation, civic engagement, and accessibility data for Washington, DC</p>
    <div style="margin-top: 20px;">
      <button class="refresh-btn" onclick="refreshAllData()">üîÑ Refresh All Data</button>
      <button class="refresh-btn" onclick="toggleAutoRefresh()">‚è∞ <span id="auto-refresh-status">Enable Auto-Refresh</span></button>
    </div>
  </header>

  <div class="dashboard-grid">
    
    <!-- Metro Status Card -->
    <div class="dashboard-card">
      <div class="card-header">
        <div class="card-icon">üöá</div>
        <div>
          <h2 class="card-title">Metro System Status</h2>
          <p class="card-subtitle">Real-time WMATA service information</p>
        </div>
      </div>
      
      <div id="metro-status" class="loading">Loading Metro data...</div>
      
      <div id="metro-lines" style="display: none;">
        <ul class="data-list" id="metro-lines-list">
        </ul>
      </div>
    </div>

    <!-- Capital Bikeshare Card -->
    <div class="dashboard-card">
      <div class="card-header">
        <div class="card-icon">üö≤</div>
        <div>
          <h2 class="card-title">Capital Bikeshare</h2>
          <p class="card-subtitle">Bike availability across DC</p>
        </div>
      </div>
      
      <div class="metric-value" id="bikeshare-available">--</div>
      <div class="metric-label">Available bikes across system</div>
      
      <div id="bikeshare-details" class="loading">Loading bikeshare data...</div>
    </div>

    <!-- Traffic & Safety Card -->
    <div class="dashboard-card">
      <div class="card-header">
        <div class="card-icon">üö¶</div>
        <div>
          <h2 class="card-title">Traffic & Safety</h2>
          <p class="card-subtitle">Transportation safety metrics</p>
        </div>
      </div>
      
      <div class="metric-value" id="safety-score">--</div>
      <div class="metric-label">Overall safety score (this week)</div>
      
      <div id="safety-details" class="loading">Loading safety data...</div>
    </div>

    <!-- Accessibility Score Card -->
    <div class="dashboard-card">
      <div class="card-header">
        <div class="card-icon">‚ôø</div>
        <div>
          <h2 class="card-title">Transit Accessibility</h2>
          <p class="card-subtitle">MAAC accessibility metrics</p>
        </div>
      </div>
      
      <div class="accessibility-score">
        <div class="score-circle score-good" id="accessibility-circle">B+</div>
        <div>
          <div style="font-weight: 600; color: #87CEFA;">System Accessibility</div>
          <div style="font-size: 0.9rem; opacity: 0.8;">Based on elevator status, platform access, and service alerts</div>
        </div>
      </div>
      
      <div id="accessibility-details" class="loading">Loading accessibility data...</div>
    </div>

    <!-- Civic Engagement Card -->
    <div class="dashboard-card">
      <div class="card-header">
        <div class="card-icon">üó≥Ô∏è</div>
        <div>
          <h2 class="card-title">Civic Engagement</h2>
          <p class="card-subtitle">Voter registration and participation</p>
        </div>
      </div>
      
      <div class="metric-value" id="voter-registration">--</div>
      <div class="metric-label">Voter registration rate (estimated)</div>
      
      <div id="civic-details" class="loading">Loading civic data...</div>
    </div>

    <!-- Weather & Air Quality Card -->
    <div class="dashboard-card">
      <div class="card-header">
        <div class="card-icon">üå§Ô∏è</div>
        <div>
          <h2 class="card-title">Environmental Conditions</h2>
          <p class="card-subtitle">Weather and air quality for commuting</p>
        </div>
      </div>
      
      <div class="metric-value" id="aqi-value">--</div>
      <div class="metric-label">Air Quality Index</div>
      
      <div id="weather-details" class="loading">Loading environmental data...</div>
    </div>

  </div>

  <div class="last-updated">
    <div>Data sources: WMATA API, Capital Bikeshare, DC Open Data, EPA AirNow</div>
    <div>Last updated: <span id="last-update-time">--</span></div>
    <div style="margin-top: 8px; font-size: 0.75rem;">
      This dashboard supports MAAC's mission to improve transportation accessibility in DC
    </div>
  </div>
</div>

<!-- Enhanced Scripts -->
<script src="scripts/accessibility_controls.js"></script>
<script src="scripts/enhanced_search.js"></script>
<script src="scripts/quick_access.js"></script>
<script src="scripts/pwa_manager.js"></script>
<script src="scripts/keyboard_nav.js"></script>

<script>
// DC Data Dashboard JavaScript
class DCDataDashboard {
  constructor() {
    this.autoRefreshEnabled = false;
    this.autoRefreshInterval = null;
    this.updateInterval = 5 * 60 * 1000; // 5 minutes
    this.lastUpdateTime = null;
    
    this.init();
  }

  init() {
    this.loadAllData();
    this.setupAutoRefresh();
    this.setupKeyboardShortcuts();
  }

  async loadAllData() {
    console.log('Loading DC dashboard data...');
    
    const loadingPromises = [
      this.loadMetroData(),
      this.loadBikeshareData(),
      this.loadSafetyData(),
      this.loadAccessibilityData(),
      this.loadCivicData(),
      this.loadEnvironmentalData()
    ];

    try {
      await Promise.allSettled(loadingPromises);
      this.updateLastUpdateTime();
    } catch (error) {
      console.error('Error loading dashboard data:', error);
    }
  }

  async loadMetroData() {
    const statusEl = document.getElementById('metro-status');
    const linesEl = document.getElementById('metro-lines');
    const listEl = document.getElementById('metro-lines-list');

    try {
      // Simulate Metro API data (replace with real API calls)
      const metroData = await this.simulateMetroData();
      
      let overallStatus = 'good';
      if (metroData.some(line => line.delays > 10)) overallStatus = 'alert';
      else if (metroData.some(line => line.delays > 5)) overallStatus = 'warning';

      statusEl.innerHTML = `
        <div class="status-indicator status-${overallStatus}">
          ${overallStatus === 'good' ? '‚úÖ Normal Service' : 
            overallStatus === 'warning' ? '‚ö†Ô∏è Minor Delays' : 'üö® Service Disruptions'}
        </div>
      `;

      listEl.innerHTML = metroData.map(line => `
        <li>
          <span class="line-name">${line.name} Line</span>
          <span class="delay-time delay-${line.delays > 10 ? 'alert' : line.delays > 5 ? 'warning' : 'good'}">
            ${line.delays > 0 ? `+${line.delays}min` : 'On time'}
          </span>
        </li>
      `).join('');

      linesEl.style.display = 'block';
      statusEl.classList.remove('loading');

    } catch (error) {
      statusEl.innerHTML = '<div class="error">Unable to load Metro data</div>';
    }
  }

  async loadBikeshareData() {
    const availableEl = document.getElementById('bikeshare-available');
    const detailsEl = document.getElementById('bikeshare-details');

    try {
      // Simulate bikeshare data
      const bikeshareData = await this.simulateBikeshareData();
      
      availableEl.textContent = bikeshareData.totalAvailable.toLocaleString();
      
      detailsEl.innerHTML = `
        <div class="status-indicator status-good">
          ${bikeshareData.stationsActive}/${bikeshareData.totalStations} stations active
        </div>
        <ul class="data-list">
          <li><span>Bikes available</span><span>${bikeshareData.totalAvailable}</span></li>
          <li><span>Docks available</span><span>${bikeshareData.totalDocks}</span></li>
          <li><span>E-bikes available</span><span>${bikeshareData.ebikeCount}</span></li>
        </ul>
      `;
      
      detailsEl.classList.remove('loading');

    } catch (error) {
      detailsEl.innerHTML = '<div class="error">Unable to load bikeshare data</div>';
    }
  }

  async loadSafetyData() {
    const scoreEl = document.getElementById('safety-score');
    const detailsEl = document.getElementById('safety-details');

    try {
      // Simulate safety data based on your MAAC work
      const safetyData = await this.simulateSafetyData();
      
      scoreEl.textContent = safetyData.score;
      
      detailsEl.innerHTML = `
        <div class="status-indicator status-${safetyData.status}">
          ${safetyData.status === 'good' ? '‚úÖ Good Safety Week' : 
            safetyData.status === 'warning' ? '‚ö†Ô∏è Increased Incidents' : 'üö® Safety Concerns'}
        </div>
        <ul class="data-list">
          <li><span>Traffic incidents</span><span>${safetyData.incidents}</span></li>
          <li><span>Construction zones</span><span>${safetyData.construction}</span></li>
          <li><span>Pedestrian crossings improved</span><span>${safetyData.improvements}</span></li>
        </ul>
      `;
      
      detailsEl.classList.remove('loading');

    } catch (error) {
      detailsEl.innerHTML = '<div class="error">Unable to load safety data</div>';
    }
  }

  async loadAccessibilityData() {
    const circleEl = document.getElementById('accessibility-circle');
    const detailsEl = document.getElementById('accessibility-details');

    try {
      // Simulate accessibility data relevant to MAAC
      const accessData = await this.simulateAccessibilityData();
      
      circleEl.textContent = accessData.grade;
      circleEl.className = `score-circle score-${accessData.level}`;
      
      detailsEl.innerHTML = `
        <ul class="data-list">
          <li><span>Elevators operational</span><span>${accessData.elevators}%</span></li>
          <li><span>Accessible buses</span><span>${accessData.buses}%</span></li>
          <li><span>Platform accessibility</span><span>${accessData.platforms}%</span></li>
          <li><span>Audio announcements</span><span>${accessData.audio}%</span></li>
        </ul>
        <div style="margin-top: 12px; font-size: 0.9rem; opacity: 0.8;">
          MAAC tracks these metrics to improve transit accessibility for all users.
        </div>
      `;
      
      detailsEl.classList.remove('loading');

    } catch (error) {
      detailsEl.innerHTML = '<div class="error">Unable to load accessibility data</div>';
    }
  }

  async loadCivicData() {
    const registrationEl = document.getElementById('voter-registration');
    const detailsEl = document.getElementById('civic-details');

    try {
      // Simulate civic engagement data
      const civicData = await this.simulateCivicData();
      
      registrationEl.textContent = `${civicData.registrationRate}%`;
      
      detailsEl.innerHTML = `
        <ul class="data-list">
          <li><span>Registered voters</span><span>${civicData.registered.toLocaleString()}</span></li>
          <li><span>Recent registrations</span><span>+${civicData.recentRegistrations}</span></li>
          <li><span>Upcoming elections</span><span>${civicData.upcomingElections}</span></li>
        </ul>
        <div style="margin-top: 12px;">
          <div class="status-indicator status-good">
            üìä Data from DC Board of Elections & Census
          </div>
        </div>
      `;
      
      detailsEl.classList.remove('loading');

    } catch (error) {
      detailsEl.innerHTML = '<div class="error">Unable to load civic data</div>';
    }
  }

  async loadEnvironmentalData() {
    const aqiEl = document.getElementById('aqi-value');
    const detailsEl = document.getElementById('weather-details');

    try {
      // Simulate environmental data
      const envData = await this.simulateEnvironmentalData();
      
      aqiEl.textContent = envData.aqi;
      
      const aqiStatus = envData.aqi <= 50 ? 'good' : envData.aqi <= 100 ? 'warning' : 'alert';
      const aqiText = envData.aqi <= 50 ? 'Good' : envData.aqi <= 100 ? 'Moderate' : 'Unhealthy';
      
      detailsEl.innerHTML = `
        <div class="status-indicator status-${aqiStatus}">
          üå¨Ô∏è Air Quality: ${aqiText}
        </div>
        <ul class="data-list">
          <li><span>Temperature</span><span>${envData.temperature}¬∞F</span></li>
          <li><span>Humidity</span><span>${envData.humidity}%</span></li>
          <li><span>Wind speed</span><span>${envData.windSpeed} mph</span></li>
          <li><span>UV Index</span><span>${envData.uvIndex}</span></li>
        </ul>
      `;
      
      detailsEl.classList.remove('loading');

    } catch (error) {
      detailsEl.innerHTML = '<div class="error">Unable to load environmental data</div>';
    }
  }

  // Simulation methods (replace with real API calls)
  async simulateMetroData() {
    await this.simulateDelay(800, 1500);
    
    const lines = ['Red', 'Blue', 'Orange', 'Green', 'Yellow', 'Silver'];
    return lines.map(line => ({
      name: line,
      delays: Math.floor(Math.random() * 15)
    }));
  }

  async simulateBikeshareData() {
    await this.simulateDelay(600, 1200);
    
    return {
      totalAvailable: 2847 + Math.floor(Math.random() * 500),
      totalDocks: 1423 + Math.floor(Math.random() * 200),
      ebikeCount: 456 + Math.floor(Math.random() * 100),
      stationsActive: 647,
      totalStations: 692
    };
  }

  async simulateSafetyData() {
    await this.simulateDelay(700, 1300);
    
    const incidents = Math.floor(Math.random() * 20) + 5;
    const score = Math.max(60, 100 - incidents * 2);
    
    return {
      score: score,
      status: score >= 85 ? 'good' : score >= 70 ? 'warning' : 'alert',
      incidents: incidents,
      construction: Math.floor(Math.random() * 12) + 3,
      improvements: Math.floor(Math.random() * 8) + 2
    };
  }

  async simulateAccessibilityData() {
    await this.simulateDelay(500, 1000);
    
    const elevators = 88 + Math.floor(Math.random() * 10);
    const buses = 92 + Math.floor(Math.random() * 6);
    const platforms = 76 + Math.floor(Math.random() * 15);
    const audio = 94 + Math.floor(Math.random() * 5);
    
    const average = (elevators + buses + platforms + audio) / 4;
    const grade = average >= 90 ? 'A' : average >= 85 ? 'B+' : average >= 80 ? 'B' : average >= 75 ? 'C+' : 'C';
    const level = average >= 90 ? 'excellent' : average >= 80 ? 'good' : 'poor';
    
    return {
      grade,
      level,
      elevators,
      buses,
      platforms,
      audio
    };
  }

  async simulateCivicData() {
    await this.simulateDelay(900, 1400);
    
    return {
      registrationRate: 84 + Math.floor(Math.random() * 8),
      registered: 524000 + Math.floor(Math.random() * 10000),
      recentRegistrations: Math.floor(Math.random() * 500) + 100,
      upcomingElections: 2
    };
  }

  async simulateEnvironmentalData() {
    await this.simulateDelay(400, 800);
    
    return {
      aqi: 35 + Math.floor(Math.random() * 40),
      temperature: 68 + Math.floor(Math.random() * 20),
      humidity: 45 + Math.floor(Math.random() * 30),
      windSpeed: Math.floor(Math.random() * 15) + 2,
      uvIndex: Math.floor(Math.random() * 8) + 1
    };
  }

  simulateDelay(min, max) {
    return new Promise(resolve => {
      setTimeout(resolve, Math.random() * (max - min) + min);
    });
  }

  setupAutoRefresh() {
    const statusSpan = document.getElementById('auto-refresh-status');
    
    window.toggleAutoRefresh = () => {
      this.autoRefreshEnabled = !this.autoRefreshEnabled;
      
      if (this.autoRefreshEnabled) {
        statusSpan.textContent = 'Disable Auto-Refresh';
        this.autoRefreshInterval = setInterval(() => {
          this.loadAllData();
        }, this.updateInterval);
        
        this.showNotification('üîÑ Auto-refresh enabled (every 5 minutes)', 'success');
      } else {
        statusSpan.textContent = 'Enable Auto-Refresh';
        if (this.autoRefreshInterval) {
          clearInterval(this.autoRefreshInterval);
          this.autoRefreshInterval = null;
        }
        
        this.showNotification('‚è∏Ô∏è Auto-refresh disabled', 'info');
      }
    };
  }

  setupKeyboardShortcuts() {
    document.addEventListener('keydown', (e) => {
      if (e.target.tagName.toLowerCase() === 'input' || e.target.tagName.toLowerCase() === 'textarea') {
        return;
      }
      
      if (e.key === 'r' && !e.ctrlKey && !e.metaKey) {
        e.preventDefault();
        window.refreshAllData();
      }
    });
  }

  updateLastUpdateTime() {
    this.lastUpdateTime = new Date();
    const timeEl = document.getElementById('last-update-time');
    if (timeEl) {
      timeEl.textContent = this.lastUpdateTime.toLocaleTimeString();
    }
  }

  showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#F44336' : '#2196F3'};
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      z-index: 10000;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      animation: slideInRight 0.3s ease-out;
    `;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }
}

// Global functions
window.refreshAllData = function() {
  if (window.dcDashboard) {
    window.dcDashboard.loadAllData();
  }
};

// Initialize dashboard
document.addEventListener('DOMContentLoaded', () => {
  window.dcDashboard = new DCDataDashboard();
  
  // Add page to favorites functionality
  if (window.addPageToFavorites) {
    const favoriteBtn = document.createElement('button');
    favoriteBtn.innerHTML = '‚≠ê Add to Favorites';
    favoriteBtn.className = 'refresh-btn';
    favoriteBtn.onclick = window.addPageToFavorites;
    
    const headerBtns = document.querySelector('.dashboard-header div');
    if (headerBtns) {
      headerBtns.appendChild(favoriteBtn);
    }
  }
});
</script>

</body>
</html>
